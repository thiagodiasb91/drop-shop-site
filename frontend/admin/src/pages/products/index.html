<div x-data="getData" class="products-page">

  <div class="list-toolbar">
    <input type="text" placeholder="Buscar por nome ou SKU" x-model="search" />

    <button class="btn-primary" @click="openCreate()">
      + Novo Produto
    </button>
  </div>
  <div x-show="loading" class="loader"></div>

  <!-- DESKTOP -->

  <table class="data-table desktop-only" x-show="!loading">
    <thead>
      <tr>
        <th>SKU</th>
        <th>Produto</th>
        <th>Status</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <template x-for="product in products" :key="product.id">
        <tr class="entity-row">
          <td x-text="product.sku"></td>
          <td class="truncate" x-text="product.name"></td>          
          <td>
            <span class="badge" :class="product.active ? 'paid' : 'cancelled'"
              x-text="product.active ? 'Ativo' : 'Inativo'">
            </span>
          </td>

          <td class="actions-cell">
            <div class="actions-wrapper" x-data="{ open: false }">
              <button class="actions-btn" @click="open = !open">‚ãÆ</button>

              <div class="actions-menu" x-show="open" @click.outside="open = false">
                <button @click="openEdit(product)">‚úèÔ∏è Editar</button>
                <button @click="remove(product)">üóëÔ∏è Excluir</button>
              </div>
            </div>
          </td>
        </tr>
      </template>
    </tbody>
  </table>
  <!-- MOBILE -->
  <div class="mobile-only" x-show="!loading">
    <template x-for="product in products" :key="product.id">
      <div class="entity-card">

        <div class="entity-item-row">
          <strong class="truncate" x-text="product.name"></strong>
          <span class="badge" :class="product.active ? 'paid' : 'cancelled'"
            x-text="product.active ? 'Ativo' : 'Inativo'">
          </span>
        </div>

        <div class="entity-item-grid">
          <div>
            <small>SKU</small>
            <span x-text="product.sku"></span>
          </div>
        </div>

        <div class="entity-actions">
          <button class="btn-primary" @click="openEdit(product)">
            Editar
          </button>
          <button class="btn-secondary" @click="remove(product)">
            Excluir
          </button>
        </div>

      </div>
    </template>
  </div>


  <!-- MODAL PRODUTO -->
  <div x-show="modal.open" x-transition.opacity class="modal-overlay">

    <div class="modal" @click.outside="closeModal()" x-transition>
      <h2 x-text="modal.editing ? 'Editar Produto' : 'Novo Produto'"></h2>

      <form @submit.prevent="saveProduct()">

        <div class="form-group">
          <label>SKU</label>
          <input type="text" x-model="modal.form.sku" required />
        </div>

        <div class="form-group">
          <label>Nome do produto</label>
          <input type="text" x-model="modal.form.name" required />
        </div>

        <div class="form-group checkbox">
          <label>
            <input type="checkbox" x-model="modal.form.active" />
            Produto ativo
          </label>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" @click="closeModal()">
            Cancelar
          </button>

          <button type="submit" class="btn-primary" :disabled="modal.loading">
            <span x-show="!modal.loading">
              Salvar
            </span>

            <span x-show="modal.loading">
              Salvando...
            </span>
          </button>
        </div>

      </form>
    </div>
  </div>
</div>