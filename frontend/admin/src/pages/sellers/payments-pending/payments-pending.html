<div x-data="getData()" class="min-h-screen bg-slate-900 p-6 text-slate-100">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-10">

    <div class="bg-slate-800 p-5 rounded-xl border-l-4 border-amber-500 shadow-lg">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[10px] uppercase font-black text-slate-500 tracking-wider">A Pagar (Pendente)</p>
          <h3 class="text-2xl font-mono font-bold text-slate-100 mt-1" x-text="'R$ ' + stats.totalPending?.toFixed(2)">
          </h3>
        </div>
        <div class="bg-amber-500/10 p-2 rounded-lg text-amber-500">
          <i class="ph ph-hand-coins text-2xl"></i>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-2 text-[12px]">
        <span class="text-amber-400 font-bold" x-text="stats.pendingSuppliersCount + ' fornecedores'"></span>
        <span class="text-slate-500">aguardando repasse</span>
      </div>
    </div>

    <div class="bg-slate-800 p-5 rounded-xl border-l-4 border-emerald-500 shadow-lg">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[10px] uppercase font-black text-slate-500 tracking-wider">Total Pago (Mês)</p>
          <h3 class="text-2xl font-mono font-bold text-slate-100 mt-1"
            x-text="'R$ ' + stats.totalPaidMonth?.toFixed(2)"></h3>
        </div>
        <div class="bg-emerald-500/10 p-2 rounded-lg text-emerald-500">
          <i class="ph ph-check-circle text-2xl"></i>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-10 text-[12px]">
        <span class="text-emerald-400 font-bold w-20">↑ 20%</span>
        <span class="text-slate-500">em relação ao mês anterior</span>
      </div>
    </div>

    <div class="bg-slate-800 p-5 rounded-xl border-l-4 border-indigo-500 shadow-lg">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[10px] uppercase font-black text-slate-500 tracking-wider">Pedidos Shopee</p>
          <h3 class="text-2xl font-mono font-bold text-slate-100 mt-1" x-text="stats.totalOrdersMonth"></h3>
        </div>
        <div class="bg-indigo-500/10 p-2 rounded-lg text-indigo-500">
          <i class="ph ph-shopping-cart-simple text-2xl"></i>
        </div>
      </div>
      <div class="mt-4 flex items-center gap-2 text-[12px]">
        <span class="text-slate-300">Ticket Médio:</span>
        <span class="text-indigo-400 font-bold" x-text="'R$ ' + stats.averageTicket?.toFixed(2)"></span>
      </div>
    </div>

    <div class="bg-slate-800 p-5 rounded-xl border-l-4 border-rose-500 shadow-lg">
      <div class="flex justify-between items-start">
        <div>
          <p class="text-[10px] uppercase font-black text-slate-500 tracking-wider">Próximo Vencimento</p>
          <h3 class="text-2xl font-mono font-bold text-rose-400 mt-1" x-text="stats.nextDueDate"></h3>
        </div>
        <div class="bg-rose-500/10 p-2 rounded-lg text-rose-500">
          <i class="ph ph-calendar-blank text-2xl"></i>
        </div>
      </div>
      <div class="mt-4 text-[12px] text-slate-500">
        Faltam <span class="text-rose-400 font-bold">8 dias</span> para o próximo repasse.
      </div>
    </div>

  </div>
  <section class="mb-12">
    <div class="flex items-center gap-2 mb-4">
      <div class="h-2 w-2 rounded-full bg-amber-500 animate-pulse"></div>
      <h2 class="text-lg font-bold">Aguardando Pagamento</h2>
      <span class="text-[10px] text-slate-500 ml-2 uppercase tracking-tighter italic">Clique na linha para
        expandir</span>
    </div>

    <div class="space-y-4">
      <template x-for="sup in pendingSuppliers" :key="sup.supplierId">
        <div class="rounded-xl border border-amber-500/20 bg-slate-800 overflow-hidden">

          <div @click="toggleSupplier(sup)"
            class="p-4 flex items-center justify-between cursor-pointer hover:bg-slate-700/40 transition-colors group">

            <div class="flex items-center gap-4">
              <div
                class="h-10 w-10 rounded-full bg-amber-500/10 flex items-center justify-center text-amber-500 group-hover:bg-amber-500 group-hover:text-slate-900 transition-all duration-300">
                <i class="ph ph-clock-counter-clockwise text-xl"></i>
              </div>
              <div>
                <h3 class="font-bold group-hover:text-indigo-400 transition-colors" x-text="sup.supplierName"></h3>
                <span class="text-[10px] text-slate-500" x-text="'Vencimento: ' + sup.dueDate"></span>
              </div>
            </div>

            <div class="flex items-center gap-6">
              <div class="flex items-center gap-2 text-slate-500 group-hover:text-slate-300">
                <span
                  class="text-[9px] uppercase font-bold opacity-0 group-hover:opacity-100 transition-opacity">Detalhes</span>
                <i class="ph ph-caret-down transition-transform duration-300"
                  :class="sup.expanded ? 'rotate-180' : ''"></i>
              </div>
            </div>

            <div class="flex items-center gap-6">
              <div class="text-right">
                <span class="block text-[10px] text-slate-500 uppercase font-bold">A Pagar</span>
                <span class="text-lg font-mono font-bold text-slate-100"
                  x-text="'R$ ' + sup.totalAmount.toFixed(2)"></span>
              </div>
              <button @click="confirmPayment(sup)" :disabled="sup.processingPay"
                class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2 transition-all">
                <i class="ph ph-wallet" x-show="!sup.processingPay"></i>
                <i class="ph ph-circle-notch animate-spin" x-show="sup.processingPay"></i>
                <span>Pagar Agora</span>
              </button>
              <button @click="toggleSupplier(sup)" class="text-slate-500 hover:text-white">
                <i class="ph ph-caret-down transition-transform" :class="sup.expanded ? 'rotate-180' : ''"></i>
              </button>
            </div>
          </div>

          <div x-show="sup.expanded" x-cloak x-collapse class="border-t border-slate-700 bg-slate-900/50 p-4">
            <template x-if="sup.loadingDetails">
              <div class="flex justify-center py-4 italic text-slate-500 animate-pulse">Carregando itens vendidos...
              </div>
            </template>

            <template x-if="!sup.loadingDetails">
              <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                  <thead>
                    <tr class="text-slate-500 uppercase text-[10px] tracking-wider border-b border-slate-700">
                      <th class="pb-2">Produto</th>
                      <th class="pb-2">Pedido</th>
                      <th class="pb-2 text-center">Qtd</th>
                      <th class="pb-2 text-right">Unitário</th>
                      <th class="pb-2 text-right">Subtotal</th>
                    </tr>
                  </thead>
                  <tbody>
                    <template x-for="item in sup.details" :key="item.id">
                      <tr class="border-b border-slate-800 last:border-0">
                        <td class="py-3 flex items-center gap-3">
                          <img :src="item.imageUrl" class="h-10 w-10 rounded bg-slate-700 object-cover">
                          <span class="font-medium text-slate-200" x-text="item.name"></span>
                        </td>
                        <td class="py-3 font-mono text-xs text-slate-400" x-text="item.orderId"></td>
                        <td class="py-3 text-center" x-text="item.quantity"></td>
                        <td class="py-3 text-right font-mono" x-text="'R$ ' + item.unitPrice.toFixed(2)"></td>
                        <td class="py-3 text-right font-mono font-bold text-slate-100"
                          x-text="'R$ ' + item.total.toFixed(2)"></td>
                      </tr>
                    </template>
                  </tbody>
                </table>
              </div>
            </template>
          </div>
        </div>
      </template>

      <template x-if="pendingSuppliers.length === 0">
        <div class="py-10 text-center border-2 border-dashed border-slate-800 rounded-xl text-slate-500">
          Nenhum pagamento pendente. Tudo em dia!
        </div>
      </template>
    </div>
  </section>
  <section>
    <h2 class="text-slate-400 font-bold mb-4 uppercase text-xs tracking-widest">Histórico Concluído</h2>
    <div class="space-y-2">
      <template x-for="sup in pagedPaidList" :key="sup.supplierId">
        <div class="bg-slate-800/40 border border-slate-700 rounded-lg overflow-hidden">
          <div @click="toggleSupplier(sup)"
            class="p-3 flex justify-between items-center cursor-pointer hover:bg-indigo-500/5 border-b border-transparent hover:border-indigo-500/30 transition-all group">

            <div class="flex items-center gap-4">
              <span class="font-medium text-slate-300 group-hover:text-white" x-text="sup.supplierName"></span>
              <span class="text-xs text-slate-500 font-mono group-hover:text-indigo-400" x-text="'Pago em: ' + sup.paidAt"></span>
            </div>

            <div class="flex items-center gap-4">
              <span class="font-mono font-bold text-emerald-500/80" x-text="'R$ ' + sup.totalAmount.toFixed(2)"></span>

              <div
                class="flex items-center gap-1 text-indigo-400 opacity-0 group-hover:opacity-100 transition-opacity text-[10px] font-bold uppercase">
                <span>Ver</span>
                <i class="ph ph-eye"></i>
              </div>

              <i class="ph ph-caret-down text-xs text-slate-600 group-hover:text-indigo-400 transition-transform"
                :class="sup.expanded ? 'rotate-180' : ''"></i>
            </div>
          </div>
          <div x-show="sup.expanded" x-cloak x-collapse class="bg-slate-900/50 p-4 border-t border-slate-700">
            <template x-if="sup.loadingDetails">
              <div class="flex items-center justify-center py-6 gap-3 text-slate-500 italic text-sm">
                <div class="h-4 w-4 animate-spin rounded-full border-2 border-slate-600 border-t-indigo-500"></div>
                Carregando detalhes dos produtos...
              </div>
            </template>

            <template x-if="!sup.loadingDetails">
              <div class="overflow-x-auto">
                <table class="w-full text-left text-xs">
                  <thead>
                    <tr class="text-slate-500 uppercase text-[10px] tracking-widest border-b border-slate-800">
                      <th class="pb-3 font-black">Produto</th>
                      <th class="pb-3 font-black">Pedido (Shopee)</th>
                      <th class="pb-3 font-black text-center">Qtd</th>
                      <th class="pb-3 font-black text-right">Unitário</th>
                      <th class="pb-3 font-black text-right">Total</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-slate-800">
                    <template x-for="item in sup.details" :key="item.id">
                      <tr class="group hover:bg-slate-800/30 transition-colors">
                        <td class="py-3 flex items-center gap-3">
                          <img :src="item.imageUrl"
                            class="h-10 w-10 rounded bg-slate-700 object-cover border border-slate-600">
                          <div>
                            <div class="font-bold text-slate-200" x-text="item.name"></div>
                            <div class="text-[10px] text-slate-500 font-mono" x-text="'ID: ' + item.id"></div>
                          </div>
                        </td>
                        <td class="py-3 font-mono text-slate-400" x-text="item.orderId"></td>
                        <td class="py-3 text-center font-bold text-slate-300" x-text="item.quantity"></td>
                        <td class="py-3 text-right font-mono text-slate-400" x-text="'R$ ' + item.unitPrice.toFixed(2)">
                        </td>
                        <td class="py-3 text-right font-mono font-bold text-emerald-400"
                          x-text="'R$ ' + item.total.toFixed(2)"></td>
                      </tr>
                    </template>
                  </tbody>
                  <tfoot>
                    <tr class="border-t border-slate-700">
                      <td colspan="4" class="pt-4 text-right text-[10px] uppercase font-bold text-slate-500">Somatório
                        dos itens:</td>
                      <td class="pt-4 text-right font-mono font-black text-slate-100"
                        x-text="'R$ ' + sup.totalAmount.toFixed(2)"></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </template>
          </div>
        </div>
      </template>
    </div>

    <div class="mt-6 flex justify-center items-center gap-4 text-sm">
      <button @click="currentPage--" :disabled="currentPage === 1"
        class="px-3 py-1 bg-slate-700 rounded disabled:opacity-30">Anterior</button>
      <span x-text="currentPage + ' / ' + totalPages"></span>
      <button @click="currentPage++" :disabled="currentPage === totalPages"
        class="px-3 py-1 bg-slate-700 rounded disabled:opacity-30">Próxima</button>
    </div>
  </section>

</div>