<div x-data="getData()" class="users-page">

  <div class="list-toolbar">
    <input type="text" placeholder="Buscar usuário" x-model="search" />
  </div>
  <table class="data-table desktop-only">
    <thead>
      <tr>
        <th>Email</th>
        <th>Cognito ID</th>
        <th>Tipo</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <template x-for="user in filteredUsers" :key="user.id">
        <tr class="entity-row">

          <td>
            <span class="truncate text-secondary" style="margin-right: 5px;" x-text="user.email"></span>
            <button class="copy-btn" @click.stop="copy(user.email)" title="Copiar" aria-label="Copiar">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
            <span class="badge" :class="user.emailVerified ? 'green' : 'yellow'"
              x-text="user.emailVerified ? 'Verificado' : 'Não verificado'">
            </span>
          </td>

          <td>
            <span class="truncate text-secondary" x-text="user.cognitoId"></span>
            <button class="copy-btn" @click.stop="copy(user.cognitoId)" title="Copiar" aria-label="Copiar">
              <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
            </button>
          </td>

          <td>
            <div class="role-switch">
              <button :class="{ active: user.role === 'supplier' }" @click="setRole(user, 'supplier')">
                Fornecedor
              </button>

              <button :class="{ active: user.role === 'seller' }" @click="setRole(user, 'seller')">
                Vendedor
              </button>

              <button :class="{ active: user.role === 'admin' }" @click="setRole(user, 'admin')">
                Admin
              </button>

              <button :class="{ active: user.role === null }" @click="setRole(user, null)">
                Sem acesso
              </button>
            </div>
          </td>

          <td>
            <span x-show="user.saving" class="hint">Salvando...</span>
          </td>

        </tr>
      </template>
    </tbody>
  </table>

  <div class="mobile-only">
    <template x-for="user in filteredUsers" :key="user.id">
      <div class="entity-card">

        <div class="entity-item-row">
          <span class="truncate" x-text="user.email"></span>
          <span class="badge" :class="user.emailVerified ? 'green' : 'yellow'">
            <span x-text="user.emailVerified ? 'Verificado' : 'Não verificado'"></span>
          </span>
        </div>

        <div class="entity-item-grid">
          <small>Cognito ID</small>
          <span class="truncate" x-text="user.cognitoId"></span>
        </div>


        <div class="role-switch mobile">
          <button :class="{ active: user.role === 'supplier' }" @click="setRole(user, 'supplier')">Fornecedor</button>
          <button :class="{ active: user.role === 'seller' }" @click="setRole(user, 'seller')">Vendedor</button>
          <button :class="{ active: user.role === 'admin' }" @click="setRole(user, 'admin')">Admin</button>
          <button :class="{ active: user.role === null }" @click="setRole(user, null)">Sem acesso</button>
        </div>
        <span x-show="user.saving" class="hint">Salvando...</span>

      </div>
    </template>
  </div>
</div>